### 가상 메모리 개념
- 물리 메모리의 크기에 상관없이 메모리를 이용할 수 있도록 지언하는 기술
- 물리 메모리와 별개로 0번부터 시작하는 주소 공간을 가진다.
- 가상 주소는 물리 메모리 공간이 아니라, 가상의 주소 공간을 갖게 된다.
- 프로세스가 바라보는 메모리 영역과 메모리 관리자가 바라보는 메모리 영역으로 나뉜다.
- 가상 메모리의 크기는 물리 메모리와 스왑 영역을 합친 것
- 각각의 프로세스는 자신만의 주소 공간을 가지며, 페이지 테이블을 통해서 이를 관리한다.

### 가상메모리의 메모리 분할 방식
- 운영체제를 제외한 나머지 메모리 영여을 일정한 크기로 일반 프로세스에 할당
- 가변 분할 방식은 세그멘테이션, 고정 분할 방식을 페이징이라 하며 이 둘을 혼용한 기법이 실제로 사용된다.

### 매핑 테이블, 페이지 테이블
- 가상 메모리 시스템에서 가상 주소는 물리 메모리 혹은 스왑 영역에 위치
- 메모리 관리자는 가상 주소와 물리 주소를 일대일 매핑 테이블로 관리

### 페이징 기법
- 가상 주소는 페이지로 나누고 물리 주소는 프레임으로 나눈다.
- 페이지 테이블은 하나의 열로 구성, 각 인덱스 값이 페이지 번호, 벨류 값이 프레임 값 혹인 비어있을 수 있음

### 페이지 테이블의 관리
- 프로세스마다 페이지 테이블이 하나씩 있어야 하며, 페이지 테이블은 운영체제 영역에 위치
- 페이지 테이블의 크기가 커짐에 따라서 프로세스들이 실제로 사용 가능한 메모리 공간이 줄어들음
  - 직접 매핑: 페이지 테이블 전체를 메모리 공간의 운영체제 영역에 위치
  - 연관 매핑: 페이지 테이블 전체를 스왑 영역에서 관리
  - 직접-연관 매핑: 모든 페이지 테이블을 스왑 영역에서 관리하고 일부만 물리 메모리로 가져온다.
  - 역매핑: 프레임 번호를 기준으로테이블을 작성

### 세그맨테이션 기법
- 가변 분할 방식을 사용
- 세그맨테이션 테이블을 활용하여 가성 주소를 물리 주소로 변환

### 디맨드 페이징
- 메모리 관리자의 기본 기능은 가져오기, 배치, 재배치
- 디멘드 페이징은 프로세스가 요청할 때 메모리롤 가져오는 가져오기 기법 중 하나
- 디맨드 페이징의 반대 개념으론 필요할 것으로 생각되는 데이터를 미리 메모리로 가져오는 캐시가 있다.
- 페이징이나 세그맨테이션은 가상 메모리 공간에 어떻게 프로세스를 배치할 지를 결정하는 배치 방법이다.

### 페이지 테이블 엔트리 구조
- 페이지 테이블 구성 시에 페이지 번호, 플래그 비트, 프레임 번호가 들어감
- 플래그 비트는 아래와 같이 구성
  - a: access bit, 페이지가 메모리에 올라온 후 사용한 적이 있었는지 알려줌
  - m: modified bit, 페이지가 메모리에 올라온 후 변경 작업이 있었는지 알려줌
  - v: valid bit, 실제 메모리에 올라와 있는지를 나타냄, 스왑 공간에 있을 경우에 1 값을 가짐
  - r: read, 읽기 권한
  - w: write, 쓰기 권한
  - x: execute, 실행 권한

### 페이지 폴트
- valid bit를 사용해서 구현
- 프로세스가 가상 메모리 공간에 페이지를 요청시에 물리 공간에 해당 페이지가 안올라와 있다면 페이지 폴트 발생
- 페이지 폴트 발생 시에 해당 페이지를 스왑 공간에서 물리 메모리로 옮김
- 만일 메모리가 꽉찼다면 재배치 정책에 의해서 기존에 올라와 있던 메모리를 스왑 공간으로 옮김
- 세그멘테이션 오류는 사용자 프로세스가 주어진 메모리 공간을 벗어나거나 접근 권한이 없는 곳에 접근 시에 발생하며 사용자 프로세스에 의해서 발생하며 프로세스를 강제 종료함
- 페이지 폴트는 사용자 프로세스와는 무관, 메모리 옮기는 작업을 진행하고 프로세스 정상 진행

### 지역성
- 메모리가 꽉차서 스왑 영역으로 보낼 페이지 선택시에 지역성 활용
- 공간 지역성(spatial locality): 현재 위치에서 가까운 데이터에 접근할 확률이 더 높음
- 시간 지역성(temporal locality): 최근 접근한 데이터가 앞으로도 접근할 확률이 더 높음
- 순차 지역성(sequential locality): 여러 작업이 순서대로 진행되는 경향이 있다.
- 이러한 지역성을 고려하여 교체할 페이지를 선정하고 스왑 공간으로 옮긴다.

### 페이지 교체 알고리즘
- Optimal: 앞으로 가장 접근이 적을 페이지를 스왑
- FIFO
- LRU
- LFU
- NUR
- FIFO 변형 

### 스레싱과 프레임 할당
- 하드디스크 입출력이 너무 잦아져서 페이지 폴트가 너무 많이 발생하여 작업이 멈춘 것 같은 상태를 쓰레싱이라 한다.
- 동시에 실행되는 프로그램의 수가 많아질 수록 일정 수준까지는 CPU 사용률이 올라간다.
- 그 이상으로 많아질 경우 페이지 폴트를 처리하느라 정작 CPU 사용률이 하락하는 현상이 발생하고, 이를 쓰레싱이라 부른다.
- 따라서 남아있는 프레임을 적절하게 프로세스들에게 나눠주는 정책이 필요하다.

### 프로세스에 프레임 할당
- 정적 할당
  - 프로세스 실행 초기에 프레임 나눠준 후 크기를 고정
  - 균등 할당과 비례 할당이 있다.
- 동적 할당
  - working set model
    - 물리 메모리에 유지할 페이지의 크기를 working set size라고 하며, 여기에 들어갈 최대 페이지 수를 의미한다.
  - page fault frequency
    - 페이지 폴트 횟수를 기록하여 페이지 부재 비율을 계산, 상한선과 하한선 설정, 적정 페이지 할당량을 조절
