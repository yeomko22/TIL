## 4부 설정 패턴
### 18장 envvar설정
- 애플리케이션 내애서 설정을 하드코딩하기 보다 빌드한 후에도 변경할 수 있도록 설정을 외부화 하는 것이 좋다.
- 쿠버네티스에서는 파드 설정 시에 환경 변수의 형태로 설정 값을 전달할 수 있다.
- 이 때 configmap이나 secret을 사용할 수 있으며, 이들을 볼륨의 형태로 전달할 수도 있다.
- 컨테이너 생성 시에 주입되며 런 타임에 변경되지 않는 불변성을 지닌다. 그러나 파드를 새로 시작할 경우 변경될 수 있다.

### 19장 설정 자원
- 설정 자원 패턴이란 configmap, secret을 사용하여 환경변수 주입이 가능하다.
- 총 데이터의 크기가 1MB로 제한된다.
- envFrom 필드를 통해 한번에 conigMap, secret 전체를 환경변수로 올릴 수 있다.
- 설정 자원의 장점은 설정 데이터의 정의와 사용을 분리할 수 있다는 점이다.

### Secret은 얼마나 안전한가?
- secret은 base64 방식으로 데이터를 인코딩하여 저장하는 것으로 이는 암호화가 아니다.
- secret이 configMap보다 보안 상의 강점은 아래와 같다.
  - 시크릿은 자신에게 접근하는 파드가 실행 중인 노드에만 배포된다.
  - 노드에서 시크릿은 tmpfs 메모리에 저장되며 실제 스토리지에 기록되지 않고 파드가 제거될 때 함께 제거된다.
  - 시크릿은 etcd에 암호화 된 형태로 저장된다.
- 민감한 정보의 경우 애플리케이션 레벨에서 추가적인 암호화가 필요하다.

### 20장 불변 설정
- 불변설정 패턴은 데이터를 변경 불가능한 컨테이너 이미지에 패키징하고 런타이에 설정 컨테이너를 애플리케이션에 링크하는 방식이다.
- 즉, 설정 값 자체를 담은 이미지를 만들고, 런 타임에 이 이미지를 init container로 불러와서 여기에 담겨져 있는 설정 파일을 복사해서 전달하는 방식이다.
- 설정 자원을 사용하면 불변성이 보장되지 않는다. 이는 파드가 새로 만들어지는 와중에 설정 값 자체가 변화할 수 있음을 의미한다. 더 강력한 불변성을 강제하기 위해서 불변 설정 패턴을 이용한다.
- 딱히 불변성이 필요하지 않다면 컨피그 맵만으로도 충분하다.

### 21장 설정 템플릿
- 설정 템플릿 패턴을 사용하면 애플리케이션 시작 시 크고 복잡한 설정을 만들고 처리할 수 있다.
- 1MB를 넘어서는 대규모 설정 값이 필요할 경우 사용이 가능하다.
- 대규모 설정 파일의 내용은 일반적으로 실행환경이 달라도 큰 차이가 없다. 여러 환경에 동일한 데이터가 존재하기 때문에 컨피그맵에서 반복과 중복이 많이 발생한다.
- init 컨테이너로 템플릿 처리기를 배포하고, 여기서 런 타임 의존적인 환경 변수들을 주입해주고 파일의 형태로 볼륨에 써서 애플리케이션 컨테이너에 설정을 전달한다.
